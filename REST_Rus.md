## Source Search

**Путь**: POST source/search

**Тело запроса**:

```json
{
    "query": "SVTV",
    "limit": 10,
    "cursor": {
      "offset": 20,
      "partition": 2
    },
    "order": "name_desc",
    "source_type": [],
    "score_type": []
}
```

**Описание параметров запроса**:

- `query` (строка, обязательный): Используется для поиска по именам источников. Регистронезависимый поиск включен.
- `limit` (целое число, опциональный): Ограничивает количество источников, которые возвращаются за один запрос. Максимальное значение может быть установлено на уровне сервера. Дефолтное значение 10.
- `cursor` (объект, опциональный): Уникальный идентификатор следующей страницы записей. Возвращается только в том случае, если есть еще доступные страницы. Должен использоваться в качестве значения `cursor` в следующем запросе для получения следующей страницы записей.
  - `offset` (целое число, обязательный): отступ внутри раздела конкатенации.
  - `partition` (целое число, обязательный): номер раздела конкатенации.
- `order` (список строк, обязательный): Определяет параметр сортировки источников в порядке убывания приоритета. Допустимые значения: `name`/`name_desc` (сортировка по имени по возрастанию / убыванию), `source_type`/`source_type_desc` (сортировка по типу источника), `waffler_score`/`waffler_score_desc` (сортировка по оценке Waffler). Дефолтное значение `waffler_score`.
- `source_type` (целое число, обязательный): Тип источника. Допустимые значения: `tg`, `youtube`, и т.д.
- `score_type` (целое число, обязательный): Определяет тип счета, который нужно получить. Например, `waffler`.


**Ответ**:

```json
{
    "sources": [
        {
            "id": "ID источника 1",
            "name": "SVTV",
            "source_type": "youtube",
            "source_url": "https://www.youtube.com/@SVTVofficial",
            "waffler_score": 100
        },
        {
            "id": "ID источника 2",
            "name": "SVTV NEWS",
            "source_type": "tg",
            "source_url": "https://t.me/svtvnews",
            "waffler_score": 0
        }
    ],
  "cursor": {
    "offset": 30,
    "partition": 2
  }
}
```

**Описание ответа**:

- `sources` (массив объектов, обязательный): Список источников, соответствующих запросу. Каждый объект содержит следующие поля:
    - `id` (строка): Уникальный идентификатор источника.
    - `name` (строка): Имя источника.
    - `source_type` (целое число): Тип источника. Допустимые значения: `tg`, `youtube`, и т.д.
    - `source_url` (строка): URL источника.
    - `waffler_score` (целое число): Оценка Waffler (от 0 до 100).
- `cursor` (объект, опциональный): Уникальный идентификатор следующей страницы записей. Возвращается только в том случае, если есть еще доступные страницы. Должен использоваться в качестве значения `cursor` в следующем запросе для получения следующей страницы записей.
  - `offset` (целое число): отступ внутри раздела конкатенации.
  - `partition` (целое число): номер раздела конкатенации.

**Коды ошибок**:

- `400 Bad Request`: Если параметры запроса неверные или отсутствуют.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.


## Source Score

**Путь**: POST /source/score

**Тело запроса**:

```json
{
    "source_id": "ID источника",
    "score_type": "waffler",
    "limit": 10,
    "cursor": {
      "offset": 20,
      "partition": 2
    },
    "order": "Параметр сортировки"
}
```

**Описание параметров запроса**:

- `source_id` (строка, обязательный): Используется для идентификации источника, для которого нужно получить счета.
- `score_type` (строка, обязательный): Определяет тип счета, который нужно получить. Например, `waffler`.
- `limit` (целое число, опциональный): Ограничивает количество записей счета, которые возвращаются за один запрос. Максимальное значение может быть установлено на уровне сервера. Дефолтное значение 10.
- `cursor` (объект, опциональный): Уникальный идентификатор следующей страницы записей. Возвращается только в том случае, если есть еще доступные страницы. Должен использоваться в качестве значения `cursor` в следующем запросе для получения следующей страницы записей.
  - `offset` (целое число): отступ внутри раздела конкатенации.
  - `partition` (целое число): номер раздела конкатенации.
- `order` (список строк, опциональный): Определяет параметр сортировки записей в порядке убывания приоритета. Допустимые значения: `score`/`score_desc` (сортировка по счету по возрастанию / убыванию), `timestamp`/`timestamp_desc` (сортировка по дате записи). Дефолтное значение `timestamp_desc`.

**Ответ**:

```json
{
    "records": [
        {
            "record_text": "Текст записи",
            "score": 100,
            "timestamp": "Время записи"
        },
        {
            "text": "Текст записи",
            "score": 0,
            "timestamp": "Время записи"
        }
    ],
    "cursor": {
      "offset": 30,
      "partition": 2
    }
}
```

**Описание ответа**:

- `records` (массив объектов, обязательный): Список записей, соответствующих запросу. Каждый объект содержит следующие поля:
    - `text` (строка): Текст записи.
    - `score` (целое число): Счет, соответствующий данной записи (от 0 до 100).
    - `timestamp` (строка): Время, когда была сделана запись.
- `cursor` (объект, опциональный): Уникальный идентификатор следующей страницы записей. Возвращается только в том случае, если есть еще доступные страницы. Должен использоваться в качестве значения `cursor` в следующем запросе для получения следующей страницы записей.
  - `offset` (целое число): отступ внутри раздела конкатенации.
  - `partition` (целое число): номер раздела конкатенации.

**Коды ошибок**:

- `400 Bad Request`: Если параметры запроса неверные или отсутствуют.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.

## Source Info

**Путь**: POST /source/info

**Тело запроса**:

```json
{
    "source_url": "https://t.me/svtvnews",
    "score_type": "waffler"
}
```

**Описание параметров запроса**:

- `source_url` (строка, обязательный): URL источника, для которого нужно получить информацию.
- `score_type` (строка, обязательный): Тип счета, который нужно вычислить для обработанной информации.

**Ответ**:

```json
{
    "name": "SVTV NEWS",
    "type": "tg",
    "limit": 20
}
```

**Описание ответа**:

- `name` (строка, обязательный): Имя источника, соответствующее переданному URL. Если URL недействителен или отсутствует, вернется пустая строка.
- `type` (строка): Тип источника, соответствующий переданному URL. Если URL недействителен или отсутствует, вернется "Unknown".
- `limit` (целое число): Лимит бесплатной выкачки. Зависит от источника и типа счета.

**Коды ошибок**:

- `400 Bad Request`: Если параметр запроса неверный или отсутствует.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.

## Source Price

**Путь**: POST /source/price

**Тело запроса**:

```json
{
    "source_url": "https://t.me/svtvnews",
    "score_type": "waffler",
    "parser": {
      "type": "GPT",
      "token": "Токен парсера"
    },
    "limit": 20,
    "currency": "USDT"
}
```

**Описание параметров запроса**:

- `source_url` (строка, обязательный): URL источника, для которого нужно получить информацию.
- `score_type` (строка, обязательный): Тип счета, который нужно вычислить для обработанной информации.
- `parser` (объект, обязательный): Объект, содержащий информацию о парсере, который будет использован для обработки источника.
    - `type` (строка, обязательный): Тип парсера. Например, `GPT` или `YakiModel`.
    - `token` (строка, опциональный): Токен, используемый парсером для доступа к источнику или обработки данных. Если не указан, будет использован дефолтный.
- `limit` (целое число, опциональный): Сколько максимум выкачивать сообщений. Если не указан, то применить лимит бесплатной выкачки, посчитанный на сервере.
- `currency` (строка, опциональный): Валюта в которой считать. Например `RUB`, `GBP`, `EUR`, `USD`, `USDT`, `BTC`, `ETH`. Дефолтный зависит от адреса отправителя запроса: в РФ - `RUB`, в странах ЕС - `EUR`, в Британии - `GBP`, в остальных - `USD`.

**Ответ**:

```json
{
    "price": "0.33",
    "currency": "USDT"
}
```

**Описание ответа**:

- `price` (строка): Цена выкачки в виде обычного дробного числа. Зависит от скидок пользователя, но если пользователь не указал `access_token`, то скидки не применяются.
- `currency` (строка, опциональный): Валюта в которой считать. Например `RUB`, `GBP`, `EUR`, `USD`, `USDT`, `BTC`, `ETH`. Повторяет указанную в запросе, если она есть.

**Коды ошибок**:

- `400 Bad Request`: Если параметр запроса неверный или отсутствует.
- `401 Unauthorized`: Если запрос не бесплатный и `access_token` указан, но он недействителен.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.

# Source Parse

**Путь**: ws://server.waffler.app/source/parse

```json
{
  "source_url":  "https://t.me/svtvnews",
  "score_type": "waffler",
  "parser": {
    "type": "GPT",
    "token": "Токен парсера"
  },
  "limit": 20,
  "client_id": "id клиента"
}
```

**Параметры запроса**:

- `source_url` (строка, обязательный): URL источника, который нужно обработать.
- `score_type` (строка, обязательный): Тип счета, который нужно вычислить для обработанной информации.
- `parser` (объект, обязательный): Объект, содержащий информацию о парсере, который будет использован для обработки источника.
    - `type` (строка, обязательный): Тип парсера. Например, `GPT` или `YakiModel`.
    - `token` (строка, опциональный): Токен, используемый парсером для доступа к источнику или обработки данных. Если не указан, будет использован дефолтный.
- `limit` (целое число, опциональный): Сколько максимум выкачивать сообщений. Если не указан, то применить лимит бесплатной выкачки, посчитанный на сервере.
- `client_id` (строка, обязательный): id клиента для поддрежки работы вебсокета (если это вообще нужно в современых вебсокетах).

**Пример сообщений от сервера**:

```json
{
    "progress": "Статус прогресса"
}
```

**Описание сообщений от сервера**:

- `progress` (строка): Статус прогресса обработки источника. Может быть обновлен в реальном времени для отображения на прогрессбаре на стороне клиента.

**Коды ошибок**:

- `400 Bad Request`: Если параметры запроса неверные или отсутствуют.
- `401 Unauthorized`: Если запрос не бесплатный и `access_token` указан, но он недействителен.
- `402 Payment Required`: Если запрос не бесплатный, а `access_token` не указан.
- `509 Bandwidth Limit Exceeded`: Если запрос не бесплатный, `access_token` в порядке, но не хватает средств на счету.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.

## User Auth

**Путь**: POST /auth/login

**Тело запроса**:

```json
{
    "username": "Имя пользователя",
    "password": "Пароль"
}
```

**Описание параметров запроса**:

- `username` (строка, обязательный если не используется `refresh_token`): Имя пользователя для входа в систему.
- `password` (строка, обязательный если не используется `refresh_token`): Пароль пользователя.
- `refresh_token` (строка, обязательный если не используются `username` и `password`): Токен обновления для входа в систему.

**Ответ**:

```json
{
    "access_token": "Токен сессии",
    "refresh_token": "Токен обновления"
}
```

**Описание ответа**:

- `access_token` (строка): Токен сессии, который клиент должен использовать для аутентификации последующих запросов.
- `refresh_token` (строка): Токен обновления, который клиент может использовать для получения нового `access_token` после истечения срока его действия.

**Коды ошибок**:

- `400 Bad Request`: Если параметры запроса неверные или отсутствуют.
- `401 Unauthorized`: Если имя пользователя или пароль неверные, или если `refresh_token` недействителен.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.

## User Register

**Путь**: POST /auth/register

**Тело запроса**:

```json
{
    "username": "Имя пользователя",
    "password": "Пароль"
}
```

**Описание параметров запроса**:

- `username` (строка, обязательный): Имя пользователя для регистрации в системе.
- `password` (строка, обязательный): Пароль пользователя.

**Ответ**:

```json
{
    "access_token": "Токен сессии",
    "refresh_token": "Токен обновления"
}
```

**Описание ответа**:

- `access_token` (строка): Токен сессии, который клиент должен использовать для аутентификации последующих запросов.
- `refresh_token` (строка): Токен обновления, который клиент может использовать для получения нового `access_token` после истечения срока его действия.


**Коды ошибок**:

- `400 Bad Request`: Если параметры запроса неверные или отсутствуют.
- `409 Conflict`: Если имя пользователя уже существует.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.

## User Info

**Путь**: GET /user/info

**Заголовки запроса**:

```json
{
    "access_token": "Токен сессии"
}
```

**Описание параметров запроса**:

- `access_token` (строка, обязательный): Токен сессии, который используется для аутентификации пользователя.

**Ответ**:

```json
{
    "locale": "RU"
}
```

**Описание ответа**:

- `locale` (строка, может быть не определен): Язык пользователя.

**Коды ошибок**:

- `401 Unauthorized`: Если `refresh_token` недействителен.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.

## User Save

**Путь**: POST /user/save

**Заголовки запроса**:

```json
{
    "access_token": "Токен сессии"
}
```

**Тело запроса**:

```json
{
    "locale": "RU"
}
```

**Описание параметров запроса**:

- `locale` (строка, опциональный): Язык пользователя, который нужно сохранить.

**Коды ошибок**:

- `400 Bad Request`: Если параметры запроса неверные или отсутствуют.
- `401 Unauthorized`: Если `access_token` недействителен.
- `500 Internal Server Error`: Если произошла внутренняя ошибка сервера.
